name: Flutter CI/CD Pipeline

on:
  push:
    branches:
      - develop   # Trigger on pushes to the develop branch

jobs:
  # Job for building Android APK on Ubuntu
  # build_android:
    # runs-on: ubuntu-latest
    
    # steps:
    # - name: Checkout code
      # uses: actions/checkout@v3

    # - name: Set up Java
      # uses: actions/setup-java@v3
      # with:
        # distribution: 'zulu'
        # java-version: '17.0.6'
        # cache: 'gradle'
        # cache-dependency-path: |
          # sub-project/*.gradle*
          # sub-project/**.gradle-wrapper.properties
    
    # - name: Set up Flutter
      # uses: subosito/flutter-action@v2
      # with:
        # flutter-version: '3.24.3'
        # channel: 'stable'
        # cache: true
    
    # - name: Install dependencies and run tests
      # run: |
        # flutter --version
        # flutter pub get
        # flutter test
        
    # - name: Build APK
      # run: flutter build apk --release  # This will generate the APK for Android
    
    # - name: Upload APK artifact
      # uses: actions/upload-artifact@v3
      # with:
        # name: android-apk
        # path: build/app/outputs/flutter-apk/app-release.apk


  # Job for building iOS IPA
  build_ios:
    runs-on: macos-latest 
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.24.3' 
    
    - name: Install dependencies
      run: |
        flutter --version
        flutter pub get
        flutter test
    
    - name: Build IPA
      run: flutter build ios --release --no-codesign  # This will generate the IPA for iOS
    
    # - name: Export IPA
      # run: |
        # cd ios
        # xcodebuild -workspace Runner.xcworkspace -scheme Runner -archivePath $PWD/build/ios/archives/Runner.xcarchive archive
        # xcodebuild -exportArchive -archivePath $PWD/build/ios/archives/Runner.xcarchive -exportPath $PWD/build/ios/ipa -exportOptionsPlist $PWD/ExportOptions.plist
        # mv $PWD/build/ios/ipa/Runner.ipa $PWD/Runner.ipa
    
    - name: Upload IPA artifact
      uses: actions/upload-artifact@v3
      with:
        name: ios-ipa
        path: build/ios/iphoneos/Runner.app
  